<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="finder_route">

	<delete id="delRouteByIdSupplier">
		delete from lgk_route
		where id_supplier = #id_supplier:INTEGER#
	</delete>

    <select id="getCountRouteSupplier"
                parameterClass="com.retailsbs.logistikapp.logistic.dto.CountRouteSupplierCriteria"
                resultClass="Integer">
        select coalesce(count(id_route),0) as qty
        from lgk_route
        where 1=1
        <isNotNull property="status"><iterate prepend="and status in " property="status" open="(" close=")" conjunction=",">#status[]#</iterate></isNotNull>
        and id_supplier = #id_supplier:INTEGER#
    </select>
    
    <select id="getRouteByListRetail" 
         parameterClass="com.retailsbs.logistikapp.logistic.dto.RoutesByListRetails"
         resultClass="com.retailsbs.logistikapp.logistic.domain.Route">
     <!--
       WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
       This element was generated on Mon Aug 17 10:56:02 CDT 2015.
     -->
     select id_route, id_supplier, status, code, name, color, log_created,
       log_created_login, log_modified, log_modified_login
     from lgk_route
     where 1=1
         <isNotNull property="id_routes"><iterate prepend="and id_route in " property="id_routes" open="(" close=")" conjunction=",">#id_routes[]#</iterate></isNotNull>
     order by name ASC
         
   </select>
   
   <select id="getIdsRouteByIdTravel"     resultClass="String">
       select r.id_route
     from lgk_route r
     JOIN lgk_route_store rs on rs.id_route = r.id_route
     JOIN lgk_store s on s.id_store = rs.id_store
     where r.id_route in (
         select r.id_route
         from lgk_route r
         JOIN lgk_route_store rs on rs.id_route = r.id_route
         JOIN lgk_store s on s.id_store = rs.id_store
         JOIN lgk_waybill w on w.id_store = s.id_store
         where w.id_travel = #id_travel:INTEGER#
         group by r.id_route
     )
     group by r.id_route
     order by r.id_route
   </select>
   
   <select id="getRoutesByIdTravel"     resultClass="com.retailsbs.logistikapp.logistic.domain.Route">
       select r.id_route, r.id_supplier, r.status, r.code, r.name, r.color, r.log_created,
       r.log_created_login, r.log_modified, r.log_modified_login
     from lgk_route r
     JOIN lgk_route_store rs on rs.id_route = r.id_route
     JOIN lgk_store s on s.id_store = rs.id_store
     where r.id_route in (
         select r.id_route
         from lgk_route r
         JOIN lgk_route_store rs on rs.id_route = r.id_route
         JOIN lgk_waybill w on w.id_store = s.id_store
         where w.id_travel = #id_travel:INTEGER#
         group by r.id_route
    )
    group by r.id_route
    order by r.id_route
  </select>

</sqlMap>
